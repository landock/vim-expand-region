#!/usr/bin/env bash
set -euo pipefail

# Print debugging information
echo "Current directory: $(pwd)"
echo "Vim version:"
vim --version
echo "Vader.vim present: $(test -d vader.vim && echo "Yes" || echo "No")"
echo "Test files:"
ls test/*.vader

root_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$root_dir"

if [[ ! -d "vader.vim" ]]; then
  git clone --depth 1 https://github.com/junegunn/vader.vim.git vader.vim
fi

log_file="$(mktemp -t vim-expand-region-vader.XXXXXX.log)"
trap 'rm -f "$log_file"' EXIT

# Verbose mode to capture full test output
vim -Es -Nu test/vimrc -c 'set verbose=1' -c 'Vader! test/*.vader' -V20"$log_file" -c 'qa!'

# Output the log file contents
echo "Vader Log Contents:"
cat "$log_file"
