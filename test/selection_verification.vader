" Selection verification tests - verify actual selected content
" These tests use high-confidence assertions to verify the text that's actually selected
"
" NOTE: Multi-expansion tests (calling expand_region#next multiple times in sequence)
" currently have state leakage issues in Vader test environment. They work correctly
" in actual Vim usage but fail in automated testing. This is a known limitation.

Execute (Test 1: Expand word 'hello'):
  call TestResetBuffer()
  call setline(1, ['hello world', 'foo bar', 'baz qux'])
  normal! gg
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'hello'

Execute (Test 2: Expand word 'world' from cursor on 'o'):
  call TestResetBuffer()
  call setline(1, ['hello world', 'foo bar', 'baz qux'])
  normal! gg0w
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'world'

Execute (Test 3: Expand word 'foo' on second line):
  call TestResetBuffer()
  call setline(1, ['hello world', 'foo bar', 'baz qux'])
  normal! 2gg
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'foo'

Execute (Test 4: Expand from middle of word 'bar'):
  call TestResetBuffer()
  call setline(1, ['hello world', 'foo bar', 'baz qux'])
  normal! 2gg0w
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'bar'

Execute (Test 5: Expand inside double quoted string):
  call TestResetBuffer()
  call setline(1, ['say "hello" to me', 'another line'])
  " Position cursor inside the quotes
  normal! gg0f"l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'hello'

Execute (Test 6: Expand inside single quoted string):
  call TestResetBuffer()
  call setline(1, ["say 'world' to me"])
  normal! gg0f'l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'world'

Execute (Test 7: Expand inside parentheses):
  call TestResetBuffer()
  call setline(1, ['func(inner(outer))'])
  " Position cursor inside the parentheses (on 'i' in 'inner')
  normal! gg0f(l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'inner'

Execute (Test 8: Expand inside square brackets):
  call TestResetBuffer()
  call setline(1, ['array[index][nested]'])
  " Position cursor inside brackets (on 'i' in 'index')
  normal! gg0f[l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'index'

Execute (Test 9: Expand inside braces):
  call TestResetBuffer()
  call setline(1, ['object {key: "value"}'])
  " Position cursor inside braces
  normal! gg0f{l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'key'

Execute (Test 10: Expand word in function call):
  call TestResetBuffer()
  call setline(1, ['call function(arg)'])
  " Position on 'f' in 'function' (column 6)
  call cursor(1, 6)
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'function'

Execute (Test 11: Expand nested word):
  call TestResetBuffer()
  call setline(1, ['outer(middle(inner))'])
  " Position on 'm' in 'middle'
  normal! gg0f(l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'middle'

Execute (Test 12: Expand paragraph word):
  call TestResetBuffer()
  call setline(1, ['', 'First line', 'Second line', '', 'Next para'])
  normal! 2gg
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'First'

Execute (Test 13: Expand from inside nested quotes):
  call TestResetBuffer()
  call setline(1, ["outer \"inner 'nested'\" text"])
  " Position on 'n' in 'nested'
  normal! gg0f'l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'nested'

Execute (Test 14: Expand word at end of line):
  call TestResetBuffer()
  call setline(1, ['hello world'])
  normal! gg$
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'world'

Execute (Test 15: Expand word inside brackets):
  call TestResetBuffer()
  call setline(1, ['array[index]'])
  " Position inside brackets on 'index'
  normal! gg0f[l
  call expand_region#next('n', '+')
  normal! ""y
  normal! \<Esc>
  Assert getreg('"') ==# 'index'
