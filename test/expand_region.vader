Before:
  unlet! b:expand_region_text_objects
  let g:expand_region_use_defaults = 1

  function! ExpandRegionTestVisualText() abort
    let start_pos = getpos('v')
    let end_pos = getpos('.')
    if start_pos[1] ==# 0 || end_pos[1] ==# 0 || start_pos ==# end_pos
      let start_pos = getpos("'<")
      let end_pos = getpos("'>")
    endif
    if start_pos[1] ==# 0 || end_pos[1] ==# 0
      return ''
    endif
    if start_pos[1] > end_pos[1] || (start_pos[1] ==# end_pos[1] && start_pos[2] > end_pos[2])
      let tmp = start_pos
      let start_pos = end_pos
      let end_pos = tmp
    endif
    if start_pos[1] !=# end_pos[1]
      return ''
    endif
    let line = getline(start_pos[1])
    return strpart(line, start_pos[2] - 1, end_pos[2] - start_pos[2] + 1)
  endfunction

Execute (Basic word expansion works):
  normal! Ohello world test
  normal! 0w
  call expand_region#next('n', '+')
  Assert 1, 'Expand executed without error'

Execute (Expand to quotes works):
  normal! O"hello world"
  normal! 0w
  call expand_region#next('n', '+')
  Assert 1, 'Expand to quotes executed without error'

Execute (Nested parentheses):
  normal! O((inner) middle)
  normal! 0w
  call expand_region#next('n', '+')
  Assert 1, 'Nested parens expansion executed without error'

Execute (Multiple expansion sequence):
  normal! Ohello (world [test])
  normal! 0w
  call expand_region#next('n', '+')
  Assert 1, 'First expansion executed'
  call expand_region#next('n', '+')
  Assert 1, 'Second expansion executed'

Execute (Shrink functionality):
  normal! O"hello world"
  normal! 0w
  call expand_region#next('n', '+')
  Assert 1, 'Expand executed'
  call expand_region#next('n', '-')
  Assert 1, 'Shrink executed without error'

Execute (Shrink after multiple expands):
  normal! O[ [ [test] ] ]\<Esc>
  normal! 0
  call expand_region#next('n', '+')
  call expand_region#next('n', '+')
  call expand_region#next('n', '+')
  call expand_region#next('n', '-')
  call expand_region#next('n', '-')
  Assert 1, 'Multiple shrinks executed without error'

